# ADR-010: Hidden Source Folder Installation Architecture

**Status:** Accepted  
**Date:** 2025-11-02  
**Deciders:** Clark Mackey  
**Related:** ADR-009 (Two-Branch Strategy)

---

## Context

### The Problem

Users installing Log File Genius were experiencing confusion and errors with the manual copy-based installation process:

1. **Incorrect installations:** Users were copying the entire repository structure, including `/product` and `/project` meta-directories, into their project root
2. **Path confusion:** Manual copy commands referenced paths like `product/starter-packs/augment/scripts/` which created a `/product` folder in the user's project
3. **Error-prone process:** Multiple manual copy commands required, easy to miss steps or copy wrong files
4. **Update difficulty:** No clear path to update Log File Genius files after initial installation
5. **Pollution:** User projects ended up with meta-directories (`/product`, `/project`) that are only relevant for developing Log File Genius itself

### Example of Broken Installation

**User's project after manual installation (WRONG):**
```
my-project/
├── product/              # ❌ Meta-directory for building Log File Genius
│   ├── templates/
│   ├── docs/
│   └── scripts/
├── project/              # ❌ Our development files (planning, ADRs, specs)
│   ├── planning/
│   └── adr/
├── .augment/             # ✅ Correct
└── templates/            # ✅ Correct (if they got this far)
```

### Requirements

1. **Clean installation:** No meta-directories in user projects
2. **One-command setup:** Reduce installation to a single command
3. **Easy updates:** Simple process to update Log File Genius files
4. **Source preservation:** Keep source files accessible for reference and updates
5. **Cross-platform:** Work on Windows, Mac, Linux
6. **AI assistant agnostic:** Support Augment, Claude Code, Cursor, etc.
7. **Profile-aware:** Support different project profiles (solo-developer, team, open-source, startup)

---

## Decision

**Implement a hidden source folder installation architecture using `.log-file-genius/` as a git submodule with automated installer scripts.**

### Architecture

**Installation Structure:**
```
my-project/
├── .log-file-genius/          # Hidden source (git submodule from main branch)
│   └── product/               # Only product/ (no /project/ on main branch)
│       ├── templates/
│       ├── docs/
│       ├── starter-packs/
│       └── scripts/
│           ├── install.sh     # Automated installer (Bash)
│           ├── install.ps1    # Automated installer (PowerShell)
│           ├── cleanup.sh     # Fix incorrect installations
│           └── cleanup.ps1
│
├── .augment/                  # Generated by installer
│   └── rules/
├── templates/                 # Generated by installer
├── scripts/                   # Generated by installer
└── .logfile-config.yml        # Generated by installer
```

### Installation Flow

**One-command installation:**
```bash
# Bash/Mac/Linux
git submodule add -b main \
  https://github.com/clark-mackey/log-file-genius.git \
  .log-file-genius && \
  ./.log-file-genius/product/scripts/install.sh

# PowerShell/Windows
git submodule add -b main `
  https://github.com/clark-mackey/log-file-genius.git `
  .log-file-genius; `
  .\.log-file-genius\product\scripts\install.ps1
```

**Installer behavior:**
1. Detects AI assistant (from existing `.augment/`, `.claude/`, etc.)
2. Prompts for profile selection (solo-developer, team, open-source, startup)
3. Checks for incorrect installation (product/project in root)
4. Copies files from `.log-file-genius/product/` to appropriate locations
5. Configures profile in `.logfile-config.yml`
6. Validates installation
7. Shows next steps

**Update flow:**
```bash
# Update source
cd .log-file-genius && git pull && cd ..

# Re-run installer (smart merge, preserves customizations)
./.log-file-genius/product/scripts/update.sh
```

### Key Design Choices

1. **Hidden folder (`.log-file-genius/`):**
   - Follows convention of config folders (`.git`, `.github`, `.vscode`, `.augment`)
   - Reduces visual clutter in project root
   - Clearly indicates infrastructure/tooling, not project code
   - Won't show up in most file explorers by default

2. **Git submodule from `main` branch:**
   - Leverages ADR-009 two-branch strategy
   - `main` branch only contains `/product/` (no `/project/`)
   - Users never see our development files
   - Easy to update with `git pull`

3. **Automated installer scripts:**
   - Eliminates manual copy errors
   - Cross-platform (Bash + PowerShell)
   - Detects AI assistant automatically
   - Validates installation
   - Provides clear feedback

4. **Cleanup script:**
   - Fixes incorrect installations
   - Safe removal with confirmation
   - Guides user to correct installation

---

## Consequences

### Positive

✅ **One-command installation:** Reduces setup from ~10 manual commands to 1  
✅ **Zero meta-directory pollution:** No `/product` or `/project` in user projects  
✅ **Easy updates:** `git pull` + re-run installer  
✅ **Source preservation:** Documentation and templates always accessible in `.log-file-genius/`  
✅ **Cross-platform:** Works on Windows, Mac, Linux  
✅ **Error prevention:** Installer validates and checks for common mistakes  
✅ **Professional UX:** Colorized output, clear progress, helpful messages  
✅ **Cleanup capability:** Can fix incorrect installations automatically  
✅ **Consistent experience:** Same process for all AI assistants  
✅ **Profile-aware:** Automatically configures based on project type  

### Negative

⚠️ **Git submodule complexity:** Some users unfamiliar with submodules  
⚠️ **Disk space:** Keeps full source in `.log-file-genius/` (~2-3 MB)  
⚠️ **Hidden folder:** Less discoverable for new users (mitigated by documentation)  
⚠️ **Requires git:** Can't install without git (acceptable for target audience)  

### Neutral

ℹ️ **Breaking change:** Existing users need to migrate (cleanup script provided)  
ℹ️ **Documentation updates:** All installation docs need updating (completed)  
ℹ️ **Testing required:** Need to test on multiple platforms (in progress)  

---

## Alternatives Considered

### Alternative 1: Visible Source Folder (`log-file-genius/`)

**Pros:**
- More discoverable
- Easier to find for updates
- Matches pattern of `node_modules/`, `vendor/`

**Cons:**
- Visual clutter in project root
- Could be confused with project code
- Less professional appearance

**Decision:** Rejected in favor of hidden folder (follows conventions)

### Alternative 2: No Source Folder (Copy Once)

**Pros:**
- Simpler mental model
- No ongoing dependency
- Smaller project size

**Cons:**
- Updates require manual re-copying
- No local documentation reference
- Harder to track which version installed

**Decision:** Rejected (updates too difficult)

### Alternative 3: NPM Package

**Pros:**
- Familiar to JavaScript developers
- Standard package management
- Easy updates with `npm update`

**Cons:**
- Requires Node.js/npm (not all users have it)
- Overkill for templates and docs
- Doesn't fit non-JavaScript projects

**Decision:** Rejected (wrong tool for the job)

### Alternative 4: Manual Installation Only

**Pros:**
- No automation complexity
- Users have full control
- No git submodule required

**Cons:**
- Error-prone (proven by user feedback)
- Time-consuming
- Difficult to update
- Creates meta-directory pollution

**Decision:** Rejected (current broken state)

---

## Implementation

### Files Created

1. `product/scripts/install.sh` - Bash installer
2. `product/scripts/install.ps1` - PowerShell installer
3. `product/scripts/update.sh` - Bash updater
4. `product/scripts/update.ps1` - PowerShell updater
5. `product/scripts/cleanup.sh` - Bash cleanup
6. `product/scripts/cleanup.ps1` - PowerShell cleanup

### Files Updated

1. `README.md` - New installation section
2. `product/starter-packs/augment/README.md` - Automated installation
3. `product/starter-packs/claude-code/README.md` - Automated installation
4. `product/docs/MIGRATION_GUIDE.md` - Migration from old installation

### Testing

- [x] Bash installer on Mac/Linux
- [x] PowerShell installer on Windows
- [ ] Cleanup script on incorrect installation
- [ ] Update script with existing files
- [ ] All AI assistant options
- [ ] All profile options

---

## References

- **ADR-009:** Two-Branch Strategy (provides clean `main` branch without `/project/`)
- **ADR-008:** Product/Project Directory Separation (created the meta-directories)
- **Issue:** User reported incorrect installation with `/product` and `/project` in root
- **Implementation:** `INSTALL-IMPLEMENTATION-SUMMARY.md`

---

## Notes

This ADR represents a significant improvement in user experience and installation reliability. The hidden source folder approach balances discoverability with cleanliness, and the automated installer eliminates the most common installation errors.

The decision to use `.log-file-genius/` (hidden) over `log-file-genius/` (visible) aligns with established conventions in the developer tools ecosystem and maintains a professional, uncluttered project structure.

---

**Last Updated:** 2025-11-02

